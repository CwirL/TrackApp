{"ast":null,"code":"var _jsxFileName = \"/home/wilmer/Escritorio/trackApp/client/src/components/RealTime.js\";\nimport React, { Component } from \"react\";\nimport NavBar from \"./navegation/NavBar\";\nimport RealMap from \"./real/RealMap\";\nimport CheckCars from \"./real/CheckCars\";\nimport CarData from \"./real/CarData\";\nimport ChooseBar from \"./real/ChooseBar\";\nimport { Grid, Segment, Button, Icon, Image, Menu, Sidebar } from \"semantic-ui-react\";\nconst styles = {\n  text: {\n    color: \"white\"\n  },\n  mapContainer: {\n    height: \"500px\",\n    padding: \"0\",\n    margin: \"0\"\n  },\n  btn: {\n    fontSize: \"20px\",\n    marginBottom: \"22px\"\n  }\n};\nexport default class RealTime extends Component {\n  constructor() {\n    super();\n\n    this.handleHideClick = () => this.setState({\n      visible: false\n    });\n\n    this.handleShowClick = () => this.setState({\n      visible: true\n    });\n\n    this.handleSidebarHide = () => this.setState({\n      visible: false\n    });\n\n    this.toggleSideBar = () => {\n      this.setState({\n        visible: !this.state.visible\n      });\n    };\n\n    this.getUser = async () => {\n      const reqBody = {\n        email: \"will.canti2697@gmail.com\"\n      };\n      const req = {\n        method: \"POST\",\n        body: JSON.stringify(reqBody),\n        headers: {\n          \"Content-Type\": \"application/json\"\n        }\n      };\n\n      try {\n        let res = await fetch(\"http://3.83.109.19:5000/track/api/getUser\", req);\n        let data = await res.json();\n        let cars = [];\n        let plates = [];\n        data.cars.forEach(car => {\n          cars = [...cars, {\n            plate: car.plate,\n            active: true,\n            records: []\n          }];\n          plates = [...plates, car.plate];\n        });\n        this.setState({\n          plates,\n          cars,\n          userLoaded: true\n        });\n      } catch (err) {\n        console.log(err);\n      }\n    };\n\n    this.handleChangeCheckCar = (ind, e) => {\n      let cars = this.state.cars;\n      cars[ind].active = !cars[ind].active; // console.table(cars);\n\n      this.setState({\n        cars\n      });\n    };\n\n    this.getRecords = async () => {\n      const _this$state = this.state,\n            cars = _this$state.cars,\n            plates = _this$state.plates;\n      const reqBody = {\n        email: \"will.canti2697@gmail.com\",\n        plates: plates\n      };\n      const req = {\n        method: \"POST\",\n        body: JSON.stringify(reqBody),\n        headers: {\n          \"Content-Type\": \"application/json\"\n        }\n      };\n\n      try {\n        const res = await fetch(\"http://3.83.109.19:5000/track/api/lastPosArr\", req);\n        const curPosArr = await res.json();\n        curPosArr.map(async (curPos, i) => {\n          const addressRes = await fetch(\"https://maps.googleapis.com/maps/api/geocode/json?&latlng=\".concat(curPos.latitud, \",\").concat(curPos.longitud, \"&key=AIzaSyDqV0nn953l7QAY_1GKVKcQO6Md2YW2W1o\"));\n          const address = await addressRes.json();\n          cars[i].address = address.results[2].formatted_address;\n          cars[i].records = [...cars[i].records, {\n            lat: curPos.latitud,\n            lng: curPos.longitud\n          }];\n        });\n        this.setState({\n          cars,\n          mapLoaded: true\n        });\n      } catch (error) {\n        this.setState({\n          mess: \"Was not able to connect to the dataBase\"\n        });\n        console.log(error.message);\n      }\n    };\n\n    this.handleBounds = () => {\n      let _this$state2 = this.state,\n          fitBounds = _this$state2.fitBounds,\n          controlBoundMess = _this$state2.controlBoundMess;\n      fitBounds = !fitBounds;\n\n      if (fitBounds) {\n        controlBoundMess = \"Following\";\n      } else {\n        controlBoundMess = \"Not follow\";\n      }\n\n      this.setState({\n        fitBounds,\n        controlBoundMess\n      });\n    };\n\n    this.state = {\n      path: [],\n      mess: \"Loading\",\n      cars: [],\n      plates: [],\n      records: [],\n      userLoaded: false,\n      mapLoaded: false,\n      fitBounds: true,\n      controlBoundMess: \"Following\",\n      visible: false\n    };\n    this.btn = React.createRef();\n  }\n\n  async componentDidMount() {\n    await this.getUser();\n    await this.getRecords();\n  }\n\n  componentDidUpdate() {\n    if (this.state.mapLoaded) {\n      console.log(\"update after map loaded\");\n      setTimeout(async () => await this.getRecords(), 2000);\n    }\n  }\n\n  render() {\n    console.log(\"render\");\n    const _this$state3 = this.state,\n          mapLoaded = _this$state3.mapLoaded,\n          mess = _this$state3.mess,\n          cars = _this$state3.cars,\n          userLoaded = _this$state3.userLoaded,\n          fitBounds = _this$state3.fitBounds,\n          controlBoundMess = _this$state3.controlBoundMess,\n          visible = _this$state3.visible;\n    return React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 160\n      },\n      __self: this\n    }, React.createElement(NavBar, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 161\n      },\n      __self: this\n    }), React.createElement(Grid, {\n      stackable: true,\n      columns: 2,\n      divided: true,\n      padded: true,\n      inverted: true,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 162\n      },\n      __self: this\n    }, React.createElement(Grid.Column, {\n      width: 4,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 163\n      },\n      __self: this\n    }, userLoaded ? React.createElement(Segment, {\n      color: \"black\",\n      inverted: true,\n      style: styles.mapContainer,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 165\n      },\n      __self: this\n    }, React.createElement(Button.Group, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 166\n      },\n      __self: this\n    }, React.createElement(Button, {\n      onClick: this.toggleSideBar,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 167\n      },\n      __self: this\n    }, \"Show sidebar\")), React.createElement(Sidebar.Pushable, {\n      as: Segment,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 170\n      },\n      __self: this\n    }, React.createElement(Sidebar, {\n      as: Menu,\n      animation: \"overlay\",\n      icon: \"labeled\",\n      inverted: true,\n      onHide: this.handleSidebarHide,\n      vertical: true,\n      visible: visible,\n      width: \"thin\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 171\n      },\n      __self: this\n    }, React.createElement(Grid, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 181\n      },\n      __self: this\n    }, React.createElement(CheckCars, {\n      cars: cars,\n      handleChange: this.handleChangeCheckCar,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 182\n      },\n      __self: this\n    }))), React.createElement(CarData, {\n      cars: cars,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 188\n      },\n      __self: this\n    })), React.createElement(Sidebar.Pusher, {\n      dimmed: visible,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 190\n      },\n      __self: this\n    })) : React.createElement(\"div\", {\n      style: styles.text,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 193\n      },\n      __self: this\n    }, mess)), React.createElement(Grid.Column, {\n      width: 12,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 196\n      },\n      __self: this\n    }, mapLoaded ? React.createElement(Segment, {\n      color: \"black\",\n      inverted: true,\n      style: styles.mapContainer,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 198\n      },\n      __self: this\n    }, React.createElement(\"button\", {\n      style: styles.btn,\n      ref: this.btn,\n      onClick: this.handleBounds,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 199\n      },\n      __self: this\n    }, controlBoundMess), React.createElement(RealMap, {\n      cars: cars,\n      btnBounds: this.btn,\n      bounds: fitBounds,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 206\n      },\n      __self: this\n    })) : React.createElement(\"div\", {\n      style: styles.text,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 209\n      },\n      __self: this\n    }, mess))));\n  }\n\n}","map":{"version":3,"sources":["/home/wilmer/Escritorio/trackApp/client/src/components/RealTime.js"],"names":["React","Component","NavBar","RealMap","CheckCars","CarData","ChooseBar","Grid","Segment","Button","Icon","Image","Menu","Sidebar","styles","text","color","mapContainer","height","padding","margin","btn","fontSize","marginBottom","RealTime","constructor","handleHideClick","setState","visible","handleShowClick","handleSidebarHide","toggleSideBar","state","getUser","reqBody","email","req","method","body","JSON","stringify","headers","res","fetch","data","json","cars","plates","forEach","car","plate","active","records","userLoaded","err","console","log","handleChangeCheckCar","ind","e","getRecords","curPosArr","map","curPos","i","addressRes","latitud","longitud","address","results","formatted_address","lat","lng","mapLoaded","error","mess","message","handleBounds","fitBounds","controlBoundMess","path","createRef","componentDidMount","componentDidUpdate","setTimeout","render"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport NavBar from \"./navegation/NavBar\";\nimport RealMap from \"./real/RealMap\";\nimport CheckCars from \"./real/CheckCars\";\nimport CarData from \"./real/CarData\";\nimport ChooseBar from \"./real/ChooseBar\";\nimport {\n  Grid,\n  Segment,\n  Button,\n  Icon,\n  Image,\n  Menu,\n  Sidebar\n} from \"semantic-ui-react\";\nconst styles = {\n  text: {\n    color: \"white\"\n  },\n  mapContainer: {\n    height: \"500px\",\n    padding: \"0\",\n    margin: \"0\"\n  },\n  btn: {\n    fontSize: \"20px\",\n    marginBottom: \"22px\"\n  }\n};\n\nexport default class RealTime extends Component {\n  constructor() {\n    super();\n    this.state = {\n      path: [],\n      mess: \"Loading\",\n      cars: [],\n      plates: [],\n      records: [],\n      userLoaded: false,\n      mapLoaded: false,\n      fitBounds: true,\n      controlBoundMess: \"Following\",\n      visible: false\n    };\n    this.btn = React.createRef();\n  }\n\n  handleHideClick = () => this.setState({ visible: false });\n  handleShowClick = () => this.setState({ visible: true });\n  handleSidebarHide = () => this.setState({ visible: false });\n\n  toggleSideBar = () => {\n    this.setState({ visible: !this.state.visible });\n  };\n\n  async componentDidMount() {\n    await this.getUser();\n    await this.getRecords();\n  }\n  componentDidUpdate() {\n    if (this.state.mapLoaded) {\n      console.log(\"update after map loaded\");\n      setTimeout(async () => await this.getRecords(), 2000);\n    }\n  }\n  getUser = async () => {\n    const reqBody = { email: \"will.canti2697@gmail.com\" };\n    const req = {\n      method: \"POST\",\n      body: JSON.stringify(reqBody),\n      headers: { \"Content-Type\": \"application/json\" }\n    };\n    try {\n      let res = await fetch(\"http://3.83.109.19:5000/track/api/getUser\", req);\n      let data = await res.json();\n      let cars = [];\n      let plates = [];\n      data.cars.forEach(car => {\n        cars = [...cars, { plate: car.plate, active: true, records: [] }];\n        plates = [...plates, car.plate];\n      });\n      this.setState({\n        plates,\n        cars,\n        userLoaded: true\n      });\n    } catch (err) {\n      console.log(err);\n    }\n  };\n  handleChangeCheckCar = (ind, e) => {\n    let cars = this.state.cars;\n    cars[ind].active = !cars[ind].active;\n    // console.table(cars);\n    this.setState({ cars });\n  };\n\n  getRecords = async () => {\n    const { cars, plates } = this.state;\n    const reqBody = { email: \"will.canti2697@gmail.com\", plates: plates };\n    const req = {\n      method: \"POST\",\n      body: JSON.stringify(reqBody),\n      headers: { \"Content-Type\": \"application/json\" }\n    };\n    try {\n      const res = await fetch(\n        \"http://3.83.109.19:5000/track/api/lastPosArr\",\n        req\n      );\n      const curPosArr = await res.json();\n      curPosArr.map(async (curPos, i) => {\n        const addressRes = await fetch(\n          `https://maps.googleapis.com/maps/api/geocode/json?&latlng=${\n            curPos.latitud\n          },${curPos.longitud}&key=AIzaSyDqV0nn953l7QAY_1GKVKcQO6Md2YW2W1o`\n        );\n        const address = await addressRes.json();\n        cars[i].address = address.results[2].formatted_address;\n        cars[i].records = [\n          ...cars[i].records,\n          { lat: curPos.latitud, lng: curPos.longitud }\n        ];\n      });\n\n      this.setState({ cars, mapLoaded: true });\n    } catch (error) {\n      this.setState({ mess: \"Was not able to connect to the dataBase\" });\n      console.log(error.message);\n    }\n  };\n\n  handleBounds = () => {\n    let { fitBounds, controlBoundMess } = this.state;\n    fitBounds = !fitBounds;\n    if (fitBounds) {\n      controlBoundMess = \"Following\";\n    } else {\n      controlBoundMess = \"Not follow\";\n    }\n    this.setState({\n      fitBounds,\n      controlBoundMess\n    });\n  };\n  render() {\n    console.log(\"render\");\n    const {\n      mapLoaded,\n      mess,\n      cars,\n      userLoaded,\n      fitBounds,\n      controlBoundMess,\n      visible\n    } = this.state;\n\n    return (\n      <div>\n        <NavBar />\n        <Grid stackable columns={2} divided padded inverted>\n          <Grid.Column width={4}>\n            {userLoaded ? (\n              <Segment color=\"black\" inverted style={styles.mapContainer}>\n                <Button.Group>\n                  <Button onClick={this.toggleSideBar}>Show sidebar</Button>\n                </Button.Group>\n\n                <Sidebar.Pushable as={Segment}>\n                  <Sidebar\n                    as={Menu}\n                    animation=\"overlay\"\n                    icon=\"labeled\"\n                    inverted\n                    onHide={this.handleSidebarHide}\n                    vertical\n                    visible={visible}\n                    width=\"thin\"\n                  >\n                    <Grid>\n                      <CheckCars\n                        cars={cars}\n                        handleChange={this.handleChangeCheckCar}\n                      />\n                    </Grid>\n                  </Sidebar>\n                  <CarData cars={cars} />\n                </Sidebar.Pushable>\n                <Sidebar.Pusher dimmed={visible} />\n              </Segment>\n            ) : (\n              <div style={styles.text}>{mess}</div>\n            )}\n          </Grid.Column>\n          <Grid.Column width={12}>\n            {mapLoaded ? (\n              <Segment color=\"black\" inverted style={styles.mapContainer}>\n                <button\n                  style={styles.btn}\n                  ref={this.btn}\n                  onClick={this.handleBounds}\n                >\n                  {controlBoundMess}\n                </button>\n                <RealMap cars={cars} btnBounds={this.btn} bounds={fitBounds} />\n              </Segment>\n            ) : (\n              <div style={styles.text}>{mess}</div>\n            )}\n          </Grid.Column>\n        </Grid>\n      </div>\n    );\n  }\n}\n"]},"metadata":{},"sourceType":"module"}